name: Deploy MkDocs

on:
  push:
    branches:
      - main            # change to "master" if your default branch is master
  workflow_dispatch:     # allows manual runs from the Actions tab

permissions:
  contents: write        # required so mkdocs can push to gh-pages

concurrency:
  group: "gh-pages"
  cancel-in-progress: true

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0          # mkdocs gh-deploy needs full history for proper commits

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
          cache: 'pip'            # enable pip cache

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      # Keep the GitHub Pages homepage in sync with README.md
      - name: Sync README to docs/index.md
        run: |
          mkdir -p docs
          cp README.md docs/index.md

      - name: Build & Deploy to GitHub Pages
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}   # allow pushing to gh-pages
        run: |
          mkdocs gh-deploy --force --clean
